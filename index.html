<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora de Préstamos</title>
  <style>
    :root{
      --bg:#f7fbfd;
      --card:#ffffff;
      --ink:#17374a;
      --muted:#5a7686;
      --accent:#11cfe3;
      --accent-700:#0a99a8;
      --danger:#ff6b8a;
      --ring:#e8f5f8;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: system-ui,-apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji";}
    header{
      position:sticky;top:0;background:#0d2230;color:#fff;padding:14px 20px;z-index:10;box-shadow:0 2px 10px rgba(0,0,0,.08)
    }
    header h1{margin:0;font-weight:700;font-size:20px;letter-spacing:.2px}

    .wrap{max-width:980px;margin:20px auto;padding:0 14px}

    .grid{display:grid;gap:16px}
    @media(min-width:768px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:var(--card);border-radius:16px;box-shadow:0 8px 24px rgba(9,30,66,.05);padding:18px}
    .title{font-size:14px;text-transform:uppercase;color:var(--muted);letter-spacing:.08em;margin:0 0 6px}

    .input-row{display:flex;align-items:center;gap:12px;margin:8px 0}
    .input-row svg{width:22px;height:22px;opacity:.85}
    .input-row input{flex:1;border:2px solid var(--ring);background:#fff;border-radius:12px;padding:14px 12px;font-size:18px;color:var(--ink);outline:none;transition:border .2s}
    .input-row input:focus{border-color:var(--accent)}

    .unit{color:var(--muted);font-size:14px}

    .big{font-size:40px;font-weight:800;letter-spacing:.5px;margin:6px 0}
    .muted{color:var(--muted)}

    .bar{display:grid;grid-template-columns:1fr auto;align-items:center;gap:12px;background:#0f2b40;color:#fff;border-radius:16px;padding:18px}
    .bar .big{color:#fff;margin:0}
    .badge{writing-mode:vertical-rl; text-orientation:mixed; background:#0f2b40;border-radius:12px;padding:8px;color:#9dd7e0}

    .kpies{display:grid;gap:16px}
    @media(min-width:768px){.kpies{grid-template-columns:280px 1fr}}
    .ring{display:grid;place-items:center;}

    .legend{display:grid;gap:10px}
    .legend .row{display:flex;align-items:baseline;gap:12px}
    .pill{width:14px;height:14px;border-radius:50%}

    .btn{appearance:none;border:0;background:#0f2b40;color:#fff;border-radius:12px;padding:14px 16px;font-size:16px;font-weight:700;cursor:pointer}
    .btn:active{transform:translateY(1px)}

    .actions{display:flex;gap:14px;flex-wrap:wrap}

    /* Modal */
    dialog{border:0;border-radius:16px;max-width:960px;width:96vw;padding:0;box-shadow:0 12px 40px rgba(0,0,0,.18)}
    dialog::backdrop{background:rgba(2,18,26,.45)}
    .modal-head{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--ring)}
    .modal-body{padding:16px;max-height:70vh;overflow:auto}
    table{border-collapse:collapse;width:100%;font-size:14px}
    th,td{border-bottom:1px solid var(--ring);text-align:right;padding:10px}
    th:first-child,td:first-child{text-align:left}
    tfoot td{font-weight:800}

    .footer-note{margin-top:10px;font-size:12px;color:var(--muted)}

  </style>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0d2230">
</head>
<body>
<header>
  <h1>Calculadora de Préstamos</h1>
</header>

<div class="wrap">
  <!-- Entradas -->
  <div class="grid">
    <section class="card">
      <p class="title">Cantidad del préstamo</p>
      <div class="input-row">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 11v-1a5 5 0 0 1 10 0v1"/><rect x="2" y="11" width="14" height="10" rx="2"/></svg>
        <input id="amount" type="number" step="0.01" min="0" placeholder="0,00" inputmode="decimal" />
        <span class="unit">€</span>
      </div>

      <p class="title" style="margin-top:14px">Tasa de interés (anual)</p>
      <div class="input-row">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 5L5 19"/><circle cx="6.5" cy="6.5" r="2.5"/><circle cx="17.5" cy="17.5" r="2.5"/></svg>
        <input id="rate" type="number" step="0.01" min="0" placeholder="0,00" inputmode="decimal" />
        <span class="unit">%</span>
      </div>

      <p class="title" style="margin-top:14px">Duración</p>
      <div class="input-row">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <input id="months" type="number" step="1" min="1" placeholder="12" inputmode="numeric" />
        <span class="unit">meses</span>
      </div>
    </section>

    <!-- Pago mensual -->
    <section class="card" style="display:grid;align-content:start;gap:12px">
      <div class="bar">
        <div>
          <div class="title" style="color:#9dd7e0;letter-spacing:.2em">Pago</div>
          <div class="big" id="payment">0,00 €</div>
        </div>
        <div class="badge">al mes</div>
      </div>

      <div class="kpies">
        <div class="ring">
          <svg id="donut" width="220" height="220" viewBox="0 0 42 42" aria-hidden="true">
            <circle cx="21" cy="21" r="15.915" fill="transparent" stroke="#eef6f8" stroke-width="8"></circle>
            <circle id="sliceInterest" cx="21" cy="21" r="15.915" fill="transparent" stroke="var(--danger)" stroke-width="8" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
            <circle id="slicePrincipal" cx="21" cy="21" r="15.915" fill="transparent" stroke="var(--accent)" stroke-width="8" stroke-dasharray="0 100" stroke-dashoffset="25"></circle>
          </svg>
          <div class="muted" style="margin-top:8px"><span id="interestPct">0</span>% interés</div>
        </div>
        <div class="legend">
          <div class="row">
            <span class="pill" style="background:var(--danger)"></span>
            <div>
              <div class="title" style="margin:0">Total de Interés</div>
              <div class="big" style="font-size:28px" id="totalInterest">0,00 €</div>
            </div>
          </div>
          <div class="row">
            <span class="pill" style="background:var(--accent)"></span>
            <div>
              <div class="title" style="margin:0">Cantidad del préstamo</div>
              <div class="big" style="font-size:28px" id="principalOut">0,00 €</div>
            </div>
          </div>
          <div style="margin-top:6px">
            <div class="title" style="margin:0">Total a Pagar</div>
            <div class="big" style="font-size:32px" id="grandTotal">0,00 €</div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="showTable">Tabla de Amortización</button>
      </div>
      <p class="footer-note">No se guarda ningún dato. Todo el cálculo se realiza en este dispositivo.</p>
    </section>
  </div>
</div>

<!-- Modal Tabla -->
<dialog id="tableModal">
  <div class="modal-head">
    <strong>Tabla de Amortización</strong>
    <button class="btn" id="closeTable" style="background:#17374a">Cerrar</button>
  </div>
  <div class="modal-body">
    <table id="amortTable">
      <thead>
        <tr>
          <th>Mes</th>
          <th>Cuota</th>
          <th>Interés</th>
          <th>Amortización</th>
          <th>Saldo</th>
        </tr>
      </thead>
      <tbody></tbody>
      <tfoot>
        <tr>
          <td>Total</td>
          <td id="tCuota">—</td>
          <td id="tInteres">—</td>
          <td id="tAmort">—</td>
          <td></td>
        </tr>
      </tfoot>
    </table>
  </div>
</dialog>

<script>
  const $ = (s)=>document.querySelector(s);
  const fmt = new Intl.NumberFormat('es-ES',{style:'currency',currency:'EUR'});

  const amount = $('#amount');
  const rate = $('#rate');
  const months = $('#months');

  // Demo valores por defecto (como en la captura)
  amount.value = 959;
  rate.value = 18; // anual
  months.value = 20;

  function computePayment(P, annualRatePct, nMonths){
    const r = (annualRatePct/100)/12; // interés mensual
    if(nMonths<=0) return {payment:0,totalInterest:0,total:0};
    if(r===0){
      const payment = P / nMonths;
      return {payment,totalInterest:0,total:P};
    }
    const payment = P * r / (1 - Math.pow(1+r,-nMonths));
    const total = payment * nMonths;
    const totalInterest = total - P;
    return {payment,totalInterest,total};
  }

  function buildAmortization(P, annualRatePct, nMonths, payment){
    const r = (annualRatePct/100)/12;
    let balance = P;
    const rows = [];
    let sumInterest = 0, sumPrincipal = 0, sumPayment = 0;
    for(let m=1;m<=nMonths;m++){
      const interest = r * balance;
      const amort = Math.min(payment - interest, balance);
      balance = Math.max(0, balance - amort);
      sumInterest += interest; sumPrincipal += amort; sumPayment += (interest+amort);
      rows.push({m, payment: interest+amort, interest, amort, balance});
    }
    return {rows, totals:{interest:sumInterest, principal:sumPrincipal, payment:sumPayment}};
  }

  function updateUI(){
    const P = parseFloat(amount.value||0);
    const R = parseFloat(rate.value||0);
    const N = parseInt(months.value||0,10);
    const {payment,totalInterest,total} = computePayment(P,R,N);

    $('#payment').textContent = fmt.format(payment || 0);
    $('#totalInterest').textContent = fmt.format(totalInterest||0);
    $('#principalOut').textContent = fmt.format(P||0);
    $('#grandTotal').textContent = fmt.format(total||0);

    // donut
    const interestPct = total>0 ? (100*totalInterest/total) : 0;
    const principalPct = 100 - interestPct;
    $('#interestPct').textContent = interestPct.toFixed(1);
    // stroke-dasharray expects percents (0..100)
    const intArc = interestPct + ' ' + (100-interestPct);
    const priArc = principalPct + ' ' + (100-principalPct);
    // Offset 25 rotates to start at top
    $('#sliceInterest').setAttribute('stroke-dasharray', intArc);
    $('#slicePrincipal').setAttribute('stroke-dasharray', priArc);

    // Prebuild amortization (for modal)
    const amort = buildAmortization(P,R,N,payment||0);
    const tbody = document.querySelector('#amortTable tbody');
    tbody.innerHTML = amort.rows.map(r=>`<tr>
      <td>${r.m}</td>
      <td>${fmt.format(r.payment)}</td>
      <td>${fmt.format(r.interest)}</td>
      <td>${fmt.format(r.amort)}</td>
      <td>${fmt.format(r.balance)}</td>
    </tr>`).join('');
    $('#tCuota').textContent = fmt.format(amort.totals.payment||0);
    $('#tInteres').textContent = fmt.format(amort.totals.interest||0);
    $('#tAmort').textContent = fmt.format(amort.totals.principal||0);
  }

  ['input','change'].forEach(evt=>{
    amount.addEventListener(evt, updateUI);
    rate.addEventListener(evt, updateUI);
    months.addEventListener(evt, updateUI);
  });

  updateUI();

  // modal
  const modal = $('#tableModal');
  $('#showTable').addEventListener('click',()=>{ modal.showModal(); });
  $('#closeTable').addEventListener('click',()=>{ modal.close(); });
</script>
<script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(console.error);
    });
  }
</script>
</body>
</html>

